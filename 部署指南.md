# 环舶物流网站云部署完整指南

## 📋 目录
1. [云平台推荐及对比](#1-云平台推荐及对比)
2. [推荐平台详细部署步骤](#2-推荐平台详细部署步骤)
3. [邮件服务配置指南](#3-邮件服务配置指南)
4. [环境变量完整配置](#4-环境变量完整配置)
5. [常见问题排查](#5-常见问题排查)
6. [安全和隐私保护](#6-安全和隐私保护)

---

## 1. 云平台推荐及对比

### 🌟 推荐平台（按推荐程度排序）

| 平台 | 适用性 | 免费额度 | 优点 | 缺点 |
|------|-------|----------|------|------|
| **Render** ⭐⭐⭐⭐⭐ | Node.js全栈 | 750小时/月 | 简单易用，自动部署，免费SSL | 冷启动较慢 |
| **Railway** ⭐⭐⭐⭐⭐ | Node.js全栈 | $5免费额度 | 快速部署，好用的CLI | 免费额度有限 |
| **Vercel** ⭐⭐⭐⭐ | 前端+Serverless | 无限部署 | 速度快，CDN好 | 后端功能受限 |
| **Netlify** ⭐⭐⭐ | 主要前端 | 300分钟构建时间 | 静态网站很好 | 后端支持有限 |

### 📊 详细对比分析

#### Render（最推荐）
```
✅ 优点：
- 完全免费的Node.js应用托管
- 自动从GitHub部署
- 免费SSL证书
- 支持环境变量配置
- 数据库支持（PostgreSQL）

❌ 缺点：
- 免费版有冷启动延迟（15分钟无访问会休眠）
- 构建时间较长

💰 免费额度：750小时/月（足够个人网站使用）
```

#### Railway（备选推荐）
```
✅ 优点：
- 部署速度快
- 优秀的开发体验
- 支持多种数据库
- 无冷启动问题

❌ 缺点：
- 免费额度较少
- 超出后需要付费

💰 免费额度：$5/月（约500小时运行时间）
```

---

## 2. 推荐平台详细部署步骤

### 🚀 方案一：Render 部署（最推荐）

#### 步骤 1：准备工作
```bash
# 1. 确保项目在GitHub上
# 如果还没有，先初始化Git仓库
cd HuanboWorld
git init
git add .
git commit -m "Initial commit"

# 2. 在GitHub上创建仓库并推送
git remote add origin https://github.com/你的用户名/huanboworld.git
git push -u origin main
```

#### 步骤 2：注册Render账号
1. 访问 [https://render.com](https://render.com)
2. 点击 "Get Started for Free"
3. 选择 "GitHub" 登录（推荐）
4. 授权Render访问你的GitHub仓库

#### 步骤 3：创建Web Service
1. 登录后点击 "New +" → "Web Service"
2. 选择你的 `huanboworld` 仓库
3. 填写配置信息：
   ```
   Name: huanboworld
   Region: Singapore (亚洲用户推荐)
   Branch: main
   Runtime: Node
   Build Command: npm install
   Start Command: npm start
   ```

#### 步骤 4：配置环境变量
在Render控制台中添加环境变量：
```
NODE_ENV=production
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=你的邮箱@gmail.com
SMTP_PASS=你的应用专用密码
COMPANY_EMAIL=info@huanboworld.com
ADMIN_TOKEN=your-secret-admin-token-12345
```

#### 步骤 5：部署启动
1. 点击 "Create Web Service"
2. Render会自动构建和部署
3. 等待部署完成（通常5-10分钟）
4. 获得部署URL：`https://your-app-name.onrender.com`

---

### 🚀 方案二：Railway 部署（备选）

#### 步骤 1：安装Railway CLI
```bash
# 安装Railway CLI
npm install -g @railway/cli

# 登录Railway
railway login
```

#### 步骤 2：初始化项目
```bash
# 在项目目录下
cd HuanboWorld
railway init

# 选择 "Empty Project"
# 输入项目名称：huanboworld
```

#### 步骤 3：配置环境变量
```bash
# 设置环境变量
railway variables set NODE_ENV=production
railway variables set SMTP_HOST=smtp.gmail.com
railway variables set SMTP_PORT=587
railway variables set SMTP_USER=你的邮箱@gmail.com
railway variables set SMTP_PASS=你的应用专用密码
railway variables set COMPANY_EMAIL=info@huanboworld.com
```

#### 步骤 4：部署项目
```bash
# 部署到Railway
railway up
```

---

## 3. 邮件服务配置指南

### 📧 Gmail 配置（推荐）

#### 步骤 1：开启两步验证
1. 登录 [Google账号设置](https://myaccount.google.com)
2. 选择 "安全性"
3. 开启 "两步验证"

#### 步骤 2：生成应用专用密码
1. 在 "安全性" 页面找到 "应用专用密码"
2. 选择 "邮件" 和 "其他（自定义名称）"
3. 输入名称：`HuanboWorld Website`
4. 生成并保存16位密码（类似：`abcd efgh ijkl mnop`）

#### 步骤 3：Gmail环境变量配置
```env
# Gmail SMTP配置
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=你的邮箱@gmail.com
SMTP_PASS=abcdefghijklmnop  # 应用专用密码（去掉空格）
COMPANY_EMAIL=你的邮箱@gmail.com
```

### 📧 163邮箱配置（国内用户）

#### 步骤 1：开启SMTP服务
1. 登录 [163邮箱](https://mail.163.com)
2. 设置 → POP3/SMTP/IMAP
3. 开启 "SMTP服务"
4. 设置授权密码（不是登录密码）

#### 步骤 2：163邮箱环境变量配置
```env
# 163邮箱 SMTP配置
SMTP_HOST=smtp.163.com
SMTP_PORT=587
SMTP_USER=你的邮箱@163.com
SMTP_PASS=你设置的授权密码
COMPANY_EMAIL=你的邮箱@163.com
```

### 🔧 server.js 邮件配置说明

我们的项目已经配置好了nodemailer，无需修改代码：

```javascript
// server.js 中的邮件配置（已经写好）
const createTransporter = () => {
    return nodemailer.createTransporter({
        host: process.env.SMTP_HOST,      // 从环境变量读取
        port: process.env.SMTP_PORT,     // 从环境变量读取
        secure: false,                   // TLS连接
        auth: {
            user: process.env.SMTP_USER, // 从环境变量读取
            pass: process.env.SMTP_PASS  // 从环境变量读取
        }
    });
};
```

---

## 4. 环境变量完整配置

### 📝 .env 文件模板

创建 `.env` 文件（用于本地开发）：

```env
# ===========================================
# 环舶物流网站环境配置
# ===========================================

# 基础配置
NODE_ENV=development
PORT=3000

# ===========================================
# 邮件服务配置（选择一种）
# ===========================================

# 方案1：Gmail配置
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=你的邮箱@gmail.com
SMTP_PASS=你的应用专用密码

# 方案2：163邮箱配置
# SMTP_HOST=smtp.163.com
# SMTP_PORT=587
# SMTP_USER=你的邮箱@163.com
# SMTP_PASS=你的授权密码

# 方案3：QQ邮箱配置
# SMTP_HOST=smtp.qq.com
# SMTP_PORT=587
# SMTP_USER=你的邮箱@qq.com
# SMTP_PASS=你的授权码

# ===========================================
# 业务配置
# ===========================================

# 接收询盘的公司邮箱
COMPANY_EMAIL=info@huanboworld.com

# 管理员访问令牌（用于查看统计数据）
ADMIN_TOKEN=your-super-secret-admin-token-2024

# ===========================================
# 生产环境配置（部署时需要）
# ===========================================

# 生产环境域名
PRODUCTION_DOMAIN=https://your-app-name.onrender.com

# 文件上传限制（字节）
MAX_FILE_SIZE=5242880

# 上传目录
UPLOAD_DIR=uploads
```

### 🔧 云平台环境变量设置

#### Render平台设置
```
在Render控制台 → Settings → Environment：

NODE_ENV                = production
SMTP_HOST              = smtp.gmail.com
SMTP_PORT              = 587
SMTP_USER              = your-email@gmail.com
SMTP_PASS              = your-app-password
COMPANY_EMAIL          = info@huanboworld.com
ADMIN_TOKEN            = your-secret-token-12345
PRODUCTION_DOMAIN      = https://your-app.onrender.com
```

#### Railway平台设置
```bash
# 使用Railway CLI设置
railway variables set NODE_ENV=production
railway variables set SMTP_HOST=smtp.gmail.com
railway variables set SMTP_PORT=587
railway variables set SMTP_USER=your-email@gmail.com
railway variables set SMTP_PASS=your-app-password
railway variables set COMPANY_EMAIL=info@huanboworld.com
railway variables set ADMIN_TOKEN=your-secret-token-12345
```

---

## 5. 常见问题排查

### ❌ 部署相关问题

#### 问题1：部署失败 - "Cannot find module"
```bash
解决方案：
1. 检查 package.json 中的依赖是否完整
2. 确保 package-lock.json 也提交到仓库
3. 检查 Node.js 版本兼容性

# 本地测试：
npm install
npm start
```

#### 问题2：网站打开显示 "Application Error"
```bash
解决方案：
1. 检查环境变量是否正确设置
2. 查看平台的日志（Logs）
3. 确保 PORT 变量正确配置

# Render中查看日志：
Dashboard → 你的服务 → Logs
```

#### 问题3：静态文件加载失败
```javascript
解决方案：
确保 server.js 中正确配置静态文件：

app.use(express.static(path.join(__dirname), {
    maxAge: '1d',
    etag: true
}));
```

### ❌ 邮件相关问题

#### 问题1：邮件发送失败 - "Invalid login"
```
Gmail用户：
1. 确认开启了两步验证
2. 使用应用专用密码，不是登录密码
3. 检查用户名格式（完整邮箱地址）

163用户：
1. 确认开启了SMTP服务
2. 使用授权密码，不是登录密码
3. 检查SMTP服务器地址
```

#### 问题2：邮件发送成功但收不到
```
排查步骤：
1. 检查垃圾邮件文件夹
2. 确认 COMPANY_EMAIL 环境变量正确
3. 测试发送到不同邮箱
4. 检查邮件服务商的发送限制
```

#### 问题3：表单提交后无响应
```javascript
排查方法：
1. 打开浏览器开发者工具 → Network
2. 提交表单查看API请求状态
3. 检查控制台错误信息

常见错误：
- 400: 表单验证失败
- 500: 服务器错误（通常是邮件配置问题）
```

### 🔧 调试技巧

#### 本地测试邮件功能
```javascript
// 在 server.js 中添加测试路由（仅开发环境）
if (process.env.NODE_ENV === 'development') {
    app.get('/test-email', async (req, res) => {
        try {
            const transporter = createTransporter();
            await transporter.sendMail({
                from: process.env.SMTP_USER,
                to: process.env.COMPANY_EMAIL,
                subject: '邮件测试',
                text: '如果收到这封邮件，说明配置成功！'
            });
            res.json({ success: true, message: '测试邮件发送成功' });
        } catch (error) {
            res.status(500).json({ error: error.message });
        }
    });
}
```

---

## 6. 安全和隐私保护

### 🔒 .env 文件安全

#### ⚠️ 重要提醒
```bash
绝对不要将 .env 文件提交到 GitHub！

# 检查 .gitignore 文件包含：
.env
.env.local
.env.*.local
```

#### 正确的做法
```bash
# 1. 创建 .env.example（模板文件）
cp .env .env.example

# 2. 清空 .env.example 中的敏感信息
# 只保留配置项名称，值用占位符

# 3. 确保 .gitignore 包含 .env
echo ".env" >> .gitignore
```

### 🛡️ 敏感信息保护

#### 强密码建议
```bash
# ADMIN_TOKEN 应该使用强随机字符串
# 推荐生成方法：
openssl rand -hex 32
# 或者在线生成器：https://passwordsgenerator.net/
```

#### 环境变量安全检查清单
```
✅ SMTP_PASS - 使用应用专用密码，不是登录密码
✅ ADMIN_TOKEN - 使用强随机字符串
✅ COMPANY_EMAIL - 确认是正确的接收邮箱
✅ .env文件 - 确保在 .gitignore 中
✅ 云平台 - 使用平台的环境变量功能，不在代码中硬编码
```

### 🔐 额外安全建议

#### 1. 定期更换密码
```bash
# 建议每3-6个月更换：
- Gmail应用专用密码
- ADMIN_TOKEN
- 163邮箱授权密码
```

#### 2. 监控访问日志
```bash
# Render平台查看访问日志
Dashboard → 你的服务 → Logs → 筛选 HTTP 请求

# 关注异常访问：
- 大量404请求
- 频繁的POST请求到 /api/contact
- 来自可疑IP的访问
```

#### 3. 备份重要数据
```bash
# 定期备份表单提交数据
# 在云平台控制台下载 data/submissions.json
```

---

## 🎯 快速部署检查清单

### 部署前准备
- [ ] 代码已推送到GitHub
- [ ] `.env`文件已添加到`.gitignore`
- [ ] 邮箱SMTP服务已开启
- [ ] 应用专用密码已生成

### Render部署步骤
- [ ] 注册Render账号
- [ ] 创建Web Service
- [ ] 连接GitHub仓库
- [ ] 配置环境变量
- [ ] 启动部署
- [ ] 测试网站功能

### 功能测试
- [ ] 网站首页正常打开
- [ ] 导航菜单工作正常
- [ ] 联系表单可以提交
- [ ] 邮件能够正常发送和接收
- [ ] 移动端显示正常

---

## 📞 获取帮助

如果遇到问题，可以：

1. **查看平台文档**
   - [Render文档](https://render.com/docs)
   - [Railway文档](https://docs.railway.app)

2. **检查日志信息**
   - Render: Dashboard → Logs
   - Railway: `railway logs`

3. **社区支持**
   - [Render社区](https://community.render.com)
   - [Railway Discord](https://discord.gg/railway)

4. **邮件服务商帮助**
   - [Gmail SMTP设置](https://support.google.com/a/answer/176600)
   - [163邮箱SMTP设置](https://help.mail.163.com)

恭喜！现在您就可以将专业的货运物流网站成功部署到云端了！🚀
