# 环舶物流网站 - 中国大陆部署方案

## 🎯 针对中国大陆用户的专属部署指南

基于您的实际需求和网络环境，我为您提供三个经过验证的部署方案，确保中国大陆用户能够稳定访问。

---

## 📊 平台对比分析

| 平台 | 部署难度 | 访问稳定性 | 成本 | 微信兼容性 | 推荐指数 |
|------|----------|------------|------|------------|----------|
| **腾讯云轻量服务器** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ¥24/月起 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **阿里云ECS** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ¥30/月起 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **华为云耀云服务器** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ¥22/月起 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

---

## 🚀 方案一：腾讯云轻量应用服务器（最推荐）

### 为什么选择腾讯云？
- ✅ 专为中国大陆优化的CDN网络
- ✅ 微信生态完美兼容
- ✅ 简单易用的管理界面
- ✅ 新用户有丰富的免费试用额度
- ✅ 支持一键部署Node.js应用

### 详细部署步骤

#### 步骤 1：购买服务器
1. 访问 [腾讯云官网](https://cloud.tencent.com)
2. 注册账号并完成实名认证
3. 进入 "轻量应用服务器" 产品页
4. 选择配置：
   ```
   地域: 上海/北京（根据主要用户群体选择）
   镜像: Ubuntu 20.04
   套餐: 2核2GB内存起（¥24/月，新用户有优惠）
   ```
5. 完成购买并等待服务器创建

#### 步骤 2：连接服务器
```bash
# 使用腾讯云控制台的网页终端，或者使用SSH
ssh root@你的服务器IP
```

#### 步骤 3：安装Node.js环境
```bash
# 更新系统包
apt update && apt upgrade -y

# 安装Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
apt-get install -y nodejs

# 验证安装
node --version
npm --version

# 安装PM2进程管理器
npm install -g pm2
```

#### 步骤 4：上传项目代码
```bash
# 方法1：使用SCP上传（推荐）
# 在本地电脑上执行
cd HuanboWorld
tar -czf huanboworld.tar.gz .
scp huanboworld.tar.gz root@你的服务器IP:/root/

# 在服务器上解压
cd /root
tar -xzf huanboworld.tar.gz
mv HuanboWorld /www/huanboworld
cd /www/huanboworld

# 方法2：使用腾讯云控制台的文件上传功能
# 直接在网页上上传压缩包
```

#### 步骤 5：安装依赖并启动
```bash
# 安装项目依赖
npm install

# 创建环境变量文件
cat > .env << EOF
NODE_ENV=production
PORT=3000
SMTP_HOST=smtp.qq.com
SMTP_PORT=587
SMTP_USER=你的QQ邮箱@qq.com
SMTP_PASS=你的授权码
COMPANY_EMAIL=info@huanboworld.com
ADMIN_TOKEN=your-secure-token-$(date +%s)
EOF

# 使用PM2启动应用
pm2 start server.js --name "huanboworld"
pm2 startup
pm2 save
```

#### 步骤 6：配置防火墙和域名
```bash
# 开放端口（腾讯云控制台操作）
# 1. 进入轻量应用服务器控制台
# 2. 选择防火墙
# 3. 添加规则：TCP:3000

# 安装Nginx反向代理
apt install nginx -y

# 配置Nginx
cat > /etc/nginx/sites-available/huanboworld << EOF
server {
    listen 80;
    server_name 你的域名.com;  # 如果有域名的话
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        proxy_cache_bypass \$http_upgrade;
    }
}
EOF

# 启用站点
ln -s /etc/nginx/sites-available/huanboworld /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx
```

### 成本分析
```
基础费用：
- 轻量服务器 2核2GB：¥24/月
- 流量费用：通常包含在套餐内
- 域名（可选）：¥55/年
- SSL证书：免费（Let's Encrypt）

总计：约¥25-30/月
```

---

## 🚀 方案二：阿里云ECS（备选方案）

### 适用场景
- 需要更高的配置灵活性
- 已有阿里云生态产品
- 需要更专业的运维功能

### 快速部署步骤

#### 步骤 1：购买ECS实例
1. 登录 [阿里云控制台](https://ecs.console.aliyun.com)
2. 选择 "云服务器ECS" → "实例"
3. 创建实例：
   ```
   地域：华东1（杭州）或华北2（北京）
   实例规格：ecs.t5-lc1m2.small（1核2GB）
   镜像：Ubuntu 20.04
   网络：专有网络VPC
   安全组：开放22、80、443、3000端口
   ```

#### 步骤 2：一键部署脚本
```bash
#!/bin/bash
# 保存为 deploy.sh 并执行

# 更新系统
apt update && apt upgrade -y

# 安装Node.js和相关工具
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt-get install -y nodejs nginx certbot python3-certbot-nginx
npm install -g pm2

# 创建项目目录
mkdir -p /www/huanboworld
cd /www/huanboworld

# 如果你已经上传了代码包
# tar -xzf /path/to/huanboworld.tar.gz

echo "环境安装完成，请上传项目代码并配置环境变量"
```

#### 步骤 3：环境变量配置
```bash
# 创建 .env 文件
cat > .env << 'EOF'
NODE_ENV=production
PORT=3000

# 阿里云邮件推送（推荐）
SMTP_HOST=smtpdm.aliyun.com
SMTP_PORT=587
SMTP_USER=你的阿里云邮件用户名
SMTP_PASS=你的密码

# 或使用163邮箱
# SMTP_HOST=smtp.163.com
# SMTP_PORT=587
# SMTP_USER=你的163邮箱@163.com
# SMTP_PASS=你的授权码

COMPANY_EMAIL=info@huanboworld.com
ADMIN_TOKEN=aliyun-secure-token-$(openssl rand -hex 16)
EOF
```

---

## 🚀 方案三：华为云耀云服务器（经济方案）

### 特点
- 价格实惠，适合个人和小企业
- 简化的管理界面
- 华为云生态支持

### 部署要点
```bash
# 基本部署流程与腾讯云类似
# 主要区别在于控制台界面和网络配置

# 华为云专用的安全组配置
# 需要在控制台中配置入方向规则：
# 协议：TCP
# 端口：3000, 80, 443
# 源地址：0.0.0.0/0
```

---

## 📧 邮件服务配置（重点优化）

### QQ邮箱配置（推荐，稳定性高）
```env
SMTP_HOST=smtp.qq.com
SMTP_PORT=587
SMTP_USER=你的QQ号@qq.com
SMTP_PASS=授权码（不是密码）

# 获取QQ邮箱授权码步骤：
# 1. 登录QQ邮箱
# 2. 设置 → 账户
# 3. 开启SMTP服务
# 4. 生成授权码
```

### 163邮箱配置（备选）
```env
SMTP_HOST=smtp.163.com
SMTP_PORT=587
SMTP_USER=你的邮箱@163.com
SMTP_PASS=授权密码

# 获取163邮箱授权码：
# 1. 登录163邮箱
# 2. 设置 → POP3/SMTP/IMAP
# 3. 开启SMTP服务
# 4. 设置客户端授权密码
```

### 企业邮箱配置（推荐）
```env
# 腾讯企业邮箱
SMTP_HOST=smtp.exmail.qq.com
SMTP_PORT=587
SMTP_USER=admin@你的域名.com
SMTP_PASS=邮箱密码

# 阿里云企业邮箱
SMTP_HOST=smtp.mxhichina.com
SMTP_PORT=587
SMTP_USER=admin@你的域名.com
SMTP_PASS=邮箱密码
```

---

## 🛡️ 安全和性能优化

### 安全配置
```bash
# 1. 修改SSH默认端口
sed -i 's/#Port 22/Port 2222/' /etc/ssh/sshd_config
systemctl restart ssh

# 2. 配置防火墙
ufw enable
ufw allow 2222  # SSH端口
ufw allow 80    # HTTP
ufw allow 443   # HTTPS

# 3. 定期备份
# 创建备份脚本
cat > /root/backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
tar -czf /root/backup_${DATE}.tar.gz /www/huanboworld/data/
# 保留最新7天的备份
find /root/backup_*.tar.gz -mtime +7 -delete
EOF

chmod +x /root/backup.sh
# 添加到定时任务
echo "0 2 * * * /root/backup.sh" | crontab -
```

### 性能优化
```bash
# 1. 启用Gzip压缩
cat >> /etc/nginx/nginx.conf << 'EOF'
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
EOF

# 2. 配置缓存
# 在Nginx配置中添加
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# 3. 限制请求频率
# 防止恶意访问
location /api/ {
    limit_req zone=api burst=5 nodelay;
    proxy_pass http://localhost:3000;
}
```

---

## 🌐 域名和SSL配置

### 域名配置
```bash
# 如果你有域名（推荐购买）
# 1. 在域名提供商处设置A记录
# 记录类型：A
# 主机记录：@ 或 www
# 记录值：你的服务器IP

# 2. 等待DNS生效（通常5-30分钟）
nslookup 你的域名.com
```

### SSL证书配置
```bash
# 使用Let's Encrypt免费证书
certbot --nginx -d 你的域名.com -d www.你的域名.com

# 自动续期
echo "0 12 * * * /usr/bin/certbot renew --quiet" | crontab -
```

---

## 📱 微信兼容性确保

### 微信访问优化
```javascript
// 在HTML中添加微信兼容性配置
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

// 禁用微信内置浏览器的缓存
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
```

### 微信分享优化
```html
<!-- 添加到HTML头部 -->
<meta property="og:title" content="环舶物流 - 专业货运服务">
<meta property="og:description" content="提供专业的国际货运、清关、进出口服务">
<meta property="og:image" content="https://你的域名.com/images/share-image.jpg">
<meta property="og:url" content="https://你的域名.com">
```

---

## 🔧 常见问题解决

### 问题1：网站访问慢
```bash
# 解决方案：
1. 检查服务器地域是否离用户较近
2. 启用CDN加速（腾讯云CDN）
3. 优化图片大小和格式
4. 启用Gzip压缩
```

### 问题2：邮件发送失败
```bash
# 解决方案：
1. 检查SMTP配置是否正确
2. 确认邮箱授权码有效
3. 检查服务器防火墙设置
4. 查看应用日志：pm2 logs huanboworld
```

### 问题3：微信内打不开
```bash
# 解决方案：
1. 确保使用HTTPS
2. 避免使用被微信屏蔽的域名
3. 检查网站内容是否合规
4. 使用微信开发者工具测试
```

---

## 📈 监控和维护

### 监控脚本
```bash
# 创建健康检查脚本
cat > /root/health_check.sh << 'EOF'
#!/bin/bash
URL="http://localhost:3000/health"
if curl -f $URL > /dev/null 2>&1; then
    echo "$(date): Service is running"
else
    echo "$(date): Service is down, restarting..."
    pm2 restart huanboworld
fi
EOF

chmod +x /root/health_check.sh
echo "*/5 * * * * /root/health_check.sh >> /var/log/health_check.log" | crontab -
```

### 日志管理
```bash
# PM2日志轮转
pm2 install pm2-logrotate
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:max_size 10M
```

---

## 💰 成本优化建议

### 新用户优惠
- **腾讯云**：新用户首年6折，还有代金券
- **阿里云**：新用户有免费试用额度
- **华为云**：新用户有优惠套餐

### 长期成本控制
```
1. 选择年付套餐（通常有8-9折优惠）
2. 关注云厂商的促销活动
3. 根据实际访问量调整配置
4. 使用CDN减少服务器带宽消耗
```

---

## 🎯 推荐决策

### 基于您的需求，我的推荐优先级：

1. **首选：腾讯云轻量应用服务器**
   - 最适合中国大陆用户
   - 微信生态兼容性最好
   - 价格合理，新用户有优惠

2. **备选：阿里云ECS**
   - 如果需要更高配置
   - 企业用户推荐

3. **经济型：华为云耀云服务器**
   - 预算有限的情况下

### 立即开始部署
选择腾讯云方案，按照上述步骤，大约30分钟即可完成部署。如果需要详细指导任何步骤，请随时询问！
